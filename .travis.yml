language: cpp
sudo: required
dist: trusty
matrix:
  include:
  - os: linux
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        - llvm-toolchain-precise-3.7
        - llvm-toolchain-precise
        packages:
        - gcc-5
        - g++-5
  - os: osx
    compiler: clang
before_install:
- if [ "$CXX" = "g++" ]; then export CXX="g++-5" CC="gcc-5"; fi
before_script: 
script:
- make
- make test
- make release
after_success: 
notifications:
  email: false
before_deploy:
- export RELEASE_PKG_FILE=$(ls build/*.zip)
- echo "deploying $RELEASE_PKG_FILE to GitHub releases"
deploy:
  provider: releases
  api_key:
    secure: "qrMU5vsjrzdn244wZ9uyf+IfPNaqHUnu0P8bMsLZhXWZ716yLm/mqIEPvPG15nl3LpSYLt2RZHqEKwCJ93QRB7SJMZ07CePbKsVN8EUS5FGiiW8lWk4x9GkKzz2qX0m/toPNOTkf4gam5ukiEPzrBfaBbycw0V2za3yhfxqoN9DDlknKmxDId+ouvZOfM0s8hNOWOxk9n7Z/LaAl1i76Y1C0ivOzfDju2btLzSJkTzuh8G1Y+k+EkmsvOQGBpcwg7/JMQU/KoZYLXyrHoGUWV87l4MJh4P4q8hD2XJQ4D+HXr349sjci0JGTG6XZ12PlweqKBYz4oS1HZFtpKLHMXbqT8rV1jIHJkb9H6B1tJ6uo5EgkJRRQ9vrTtlLT0uGaV7M/PWgRvClkWuDul8YVbh+lG03ZHsgtto/q/JC1gu+Yj87hyWwN7kOU61CWjL8qo09/bwpMlRd6Zu4od79faAJ83HbX3LE6AjNANt+sc8QDWZzPk1OIOE59UJyLRuSJbGmh7zixfLaNLmt6s0akdYhQODol+tZqN6BZBXKdillbzwfpRYYRTgfAHTbi6EJmRp/+naKYhctCguUR6N7FPrjabINsjoxxgBv/ctm4hecXCmqimlJhcD07dqZaFaH8oP9fvO+2oh6pu7195bNUdFMMfnNNidynOfH20/MRd5U="  file_glob: true
  file: "${RELEASE_PKG_FILE}"
  on:
    repo: peposso/xlsx2lua
    tags: true
  skip_cleanup: true
